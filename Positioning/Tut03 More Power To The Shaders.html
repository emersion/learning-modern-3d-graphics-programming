<html><head>


<script type="text/javascript" src="/static/js/analytics.js"></script>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app4.us.archive.org";archive_analytics.values.server_ms=264;</script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>


      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>More Power to the Shaders</title><link rel="stylesheet" href="chunked.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="../index.html" title="Learning Modern 3D Graphics Programming"><link rel="up" href="Tutorial 03.html" title="Chapter&nbsp;3.&nbsp;OpenGL's Moving Triangle"><link rel="prev" href="Tut03 A Better Way.html" title="A Better Way"><link rel="next" href="Tut03 Multiple Shaders.html" title="Multiple Shaders"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(){
var wbPrefix = "/web/";
var wbCurrentUrl = "http://www.arcsynthesis.org/gltut/Positioning/Tut03%20More%20Power%20To%20The%20Shaders.html";

var firstYear = 1996;
var imgWidth = 500,imgHeight = 27;
var yearImgWidth = 25,monthImgWidth = 2;
var displayDay = "25";
var displayMonth = "Feb";
var displayYear = "2015";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function getElementX2(obj) {
  var $e=jQuery(obj);
  return (typeof $e=="undefined"||typeof $e.offset=="undefined")?
    getElementX(obj):Math.round($e.offset().left);
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX2(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})();//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>
<div id="wm-ipp" lang="en" style="display:none;">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="/web/" title="Wayback Machine home page"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0" /></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://www.arcsynthesis.org/gltut/Positioning/Tut03%20More%20Power%20To%20The%20Shaders.html" style="width:400px;" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20150225192602" /><input type="submit" value="Go" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="/web/20140813150523/http://www.arcsynthesis.org/gltut/Positioning/Tut03%20More%20Power%20To%20The%20Shaders.html" title="13 Aug 2014">AUG</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 19:26:02 Feb 25, 2015">FEB</td>
		<td class="f" nowrap="nowrap">
		
		    Mar
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="/web/20140813150523/http://www.arcsynthesis.org/gltut/Positioning/Tut03%20More%20Power%20To%20The%20Shaders.html" title="15:05:23 Aug 13, 2014"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 19:26:02 Feb 25, 2015">25</td>
	       <td class="f" nowrap="nowrap">
               
                   <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
               
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   <a href="/web/20131205183934/http://www.arcsynthesis.org/gltut/Positioning/Tut03%20More%20Power%20To%20The%20Shaders.html" title="5 Dec 2013"><strong>2013</strong></a>
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 19:26:02 Feb 25, 2015">2015</td>
	       <td class="f" nowrap="nowrap">
               
                   2016
               
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="/web/20150225192602*/http://www.arcsynthesis.org/gltut/Positioning/Tut03%20More%20Power%20To%20The%20Shaders.html" title="See a list of every capture for this URL">41 captures</a>
           <div class="r" title="Timespan for captures of this URL">22 Jan 11 - 25 Feb 15</div>
       </td>
       <td class="k">
       <a href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines"
		 onmouseover="__wm.st(1)" onmouseout="__wm.st(0)"
		 onmousemove="__wm.mv(event,this)"
		 width="500"
		 height="27"
		 border="0"
		 src="/web/jsp/graph.jsp?graphdata=500_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000000_2011:-1:100000021021_2012:-1:211121111031_2013:-1:112112111111_2014:-1:000102010000_2015:1:010000000000" />
       </div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>
<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->
<div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">More Power to the Shaders</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="Tut03 A Better Way.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;OpenGL's Moving Triangle</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="Tut03 Multiple Shaders.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3294"></a>More Power to the Shaders</h2></div></div></div><p>It's all well and good that we are no longer having to transform vertices manually.
            But perhaps we can move more things to the vertex shader. Could it be possible to move
            all of <code class="function">ComputePositionOffsets</code> to the vertex shader?</p><p>Well, no. The call to <code class="function">glutGet(GL_ELAPSED_TIME)</code> cannot be moved
            there, since GLSL code cannot directly call C/C++ functions. But everything else can be
            moved. This is what <code class="filename">vertCalcOffset.cpp</code> does.</p><p>The vertex program is found in <code class="filename">data\calcOffset.vert</code>.</p><div class="example"><a name="d0e3316"></a><p class="title"><b>Example&nbsp;3.6.&nbsp;Offset Computing Vertex Shader</b></p><div class="example-contents"><pre class="programlisting">#version <span class="code-number">330</span>

<span class="code-modifier">layout</span>(location = <span class="code-number">0</span>) <span class="code-modifier">in</span> <span class="code-type">vec4</span> position;
<span class="code-modifier">uniform</span> <span class="code-type">float</span> loopDuration;
<span class="code-modifier">uniform</span> <span class="code-type">float</span> time;

<span class="code-type">void</span> main()
{
    <span class="code-type">float</span> timeScale = <span class="code-number">3.14159f</span> * <span class="code-number">2.0f</span> / loopDuration;
    
    <span class="code-type">float</span> currTime = <span class="code-function">mod</span>(time, loopDuration);
    <span class="code-type">vec4</span> totalOffset = <span class="code-type">vec4</span>(
        <span class="code-function">cos</span>(currTime * timeScale) * <span class="code-number">0.5f</span>,
        <span class="code-function">sin</span>(currTime * timeScale) * <span class="code-number">0.5f</span>,
        <span class="code-number">0.0f</span>,
        <span class="code-number">0.0f</span>);
    
    gl_Position = position + totalOffset;
}</pre></div></div><br class="example-break"><p>This shader takes two uniforms: the duration of the loop and the elapsed time.</p><p>In this shader, we use a number of standard GLSL functions, like
                <code class="function">mod</code>, <code class="function">cos</code>, and <code class="function">sin</code>. We
            saw <code class="function">mix</code> in the last tutorial. And these are just the tip of the
            iceberg; there are a <span class="emphasis"><em>lot</em></span> of standard GLSL functions
            available.</p><p>The rendering code looks quite similar to the previous rendering code:</p><div class="example"><a name="d0e3342"></a><p class="title"><b>Example&nbsp;3.7.&nbsp;Rendering with Time</b></p><div class="example-contents"><pre class="programlisting"><span class="code-keyword">void</span> display()
{
    glClearColor(<span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>);
    glClear(GL_COLOR_BUFFER_BIT);
    
    glUseProgram(theProgram);
    
    glUniform1f(elapsedTimeUniform, glutGet(GLUT_ELAPSED_TIME) / <span class="code-number">1000.0f</span>);
    
    glBindBuffer(GL_ARRAY_BUFFER, positionBufferObject);
    glEnableVertexAttribArray(<span class="code-number">0</span>);
    glVertexAttribPointer(<span class="code-number">0</span>, <span class="code-number">4</span>, GL_FLOAT, GL_FALSE, <span class="code-number">0</span>, <span class="code-number">0</span>);
    
    glDrawArrays(GL_TRIANGLES, <span class="code-number">0</span>, <span class="code-number">3</span>);
    
    glDisableVertexAttribArray(<span class="code-number">0</span>);
    glUseProgram(<span class="code-number">0</span>);
    
    glutSwapBuffers();
    glutPostRedisplay();
}</pre></div></div><br class="example-break"><p>This time, we do not need any code to use the elapsed time; we simply pass it
            unmodified to the shader.</p><p>You may be wondering exactly how it is that the <code class="varname">loopDuration</code>
            uniform gets set. This is done in our shader initialization routine, and it is done only
            once:</p><div class="example"><a name="d0e3354"></a><p class="title"><b>Example&nbsp;3.8.&nbsp;Loop Duration Setting</b></p><div class="example-contents"><pre class="programlisting"><span class="code-keyword">void</span> InitializeProgram()
{
    std::vector&lt;GLuint&gt; shaderList;
    
    shaderList.push_back(Framework::LoadShader(GL_VERTEX_SHADER, <span class="code-string">"calcOffset.vert"</span>));
    shaderList.push_back(Framework::LoadShader(GL_FRAGMENT_SHADER, <span class="code-string">"standard.frag"</span>));
    
    theProgram = Framework::CreateProgram(shaderList);
    
    elapsedTimeUniform = glGetUniformLocation(theProgram, <span class="code-string">"time"</span>);
    
    GLuint loopDurationUnf = glGetUniformLocation(theProgram, <span class="code-string">"loopDuration"</span>);
    glUseProgram(theProgram);
    glUniform1f(loopDurationUnf, <span class="code-number">5.0f</span>);
    glUseProgram(<span class="code-number">0</span>);
}</pre></div></div><br class="example-break"><p>We get the time uniform as normal with <code class="function">glGetUniformLocation</code>. For
            the loop duration, we get that in a local variable. Then we immediately set the current
            program object, set the uniform to a value, and then unset the current program
            object.</p><p>Program objects, like all objects that contain internal state, will retain their state
            unless you explicitly change it. So the value of <code class="varname">loopDuration</code> will be
            5.0f in perpetuity; we do not need to set it every frame.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="Tut03 A Better Way.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="Tutorial 03.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="Tut03 Multiple Shaders.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">A Better Way&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="/web/20150225192602/http://www.arcsynthesis.org/gltut/index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Multiple Shaders</td></tr></table></div></body></html>




<!--
     FILE ARCHIVED ON 19:26:02 Feb 25, 2015 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 19:09:49 Mar 29, 2015.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
