<html><head>


<script type="text/javascript" src="/static/js/analytics.js"></script>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app13.us.archive.org";archive_analytics.values.server_ms=85;</script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>


      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Interpolation</title><link rel="stylesheet" href="chunked.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="../index.html" title="Learning Modern 3D Graphics Programming"><link rel="up" href="Tutorial 08.html" title="Chapter&nbsp;8.&nbsp;Getting Oriented"><link rel="prev" href="Tut08 Camera Relative Orientation.html" title="Camera-Relative Orientation"><link rel="next" href="Tut08 In Review.html" title="In Review"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(){
var wbPrefix = "/web/";
var wbCurrentUrl = "http://www.arcsynthesis.org/gltut/Positioning/Tut08%20Interpolation.html";

var firstYear = 1996;
var imgWidth = 500,imgHeight = 27;
var yearImgWidth = 25,monthImgWidth = 2;
var displayDay = "25";
var displayMonth = "Feb";
var displayYear = "2015";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function getElementX2(obj) {
  var $e=jQuery(obj);
  return (typeof $e=="undefined"||typeof $e.offset=="undefined")?
    getElementX(obj):Math.round($e.offset().left);
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX2(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})();//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>
<div id="wm-ipp" lang="en" style="display:none;">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="/web/" title="Wayback Machine home page"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0" /></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://www.arcsynthesis.org/gltut/Positioning/Tut08%20Interpolation.html" style="width:400px;" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20150225192607" /><input type="submit" value="Go" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="/web/20140813152458/http://www.arcsynthesis.org/gltut/Positioning/Tut08%20Interpolation.html" title="13 Aug 2014">AUG</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 19:26:07 Feb 25, 2015">FEB</td>
		<td class="f" nowrap="nowrap">
		
		    Mar
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="/web/20140813152458/http://www.arcsynthesis.org/gltut/Positioning/Tut08%20Interpolation.html" title="15:24:58 Aug 13, 2014"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 19:26:07 Feb 25, 2015">25</td>
	       <td class="f" nowrap="nowrap">
               
                   <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
               
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   <a href="/web/20131227093346/http://www.arcsynthesis.org/gltut/Positioning/Tut08%20Interpolation.html" title="27 Dec 2013"><strong>2013</strong></a>
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 19:26:07 Feb 25, 2015">2015</td>
	       <td class="f" nowrap="nowrap">
               
                   2016
               
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="/web/20150225192607*/http://www.arcsynthesis.org/gltut/Positioning/Tut08%20Interpolation.html" title="See a list of every capture for this URL">35 captures</a>
           <div class="r" title="Timespan for captures of this URL">13 May 11 - 25 Feb 15</div>
       </td>
       <td class="k">
       <a href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines"
		 onmouseover="__wm.st(1)" onmouseout="__wm.st(0)"
		 onmousemove="__wm.mv(event,this)"
		 width="500"
		 height="27"
		 border="0"
		 src="/web/jsp/graph.jsp?graphdata=500_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000000_2011:-1:000010111121_2012:-1:201120000021_2013:-1:112111210111_2014:-1:000101110000_2015:1:010000000000" />
       </div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>
<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->
<div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Interpolation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="Tut08 Camera Relative Orientation.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;8.&nbsp;Getting Oriented</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="Tut08 In Review.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8540"></a>Interpolation</h2></div></div></div><p>A quaternion represents an orientation; it defines a coordinate system relative to
            another. If we have two orientations, we can consider the orientation of the same object
            represented in both coordinate systems.</p><p>What if we want to generate an orientation that is halfway between them, for some
            definition of <span class="quote">&#8220;<span class="quote">halfway</span>&#8221;</span>? Or even better, consider an arbitrary
            interpolation between two orientations, so that we can watch an object move from one
            orientation to another. This would allow us to see an object smoothly moving from one
            orientation to another.</p><p>This is one more trick we can play with quaternions that we cannot with matrices.
            Linearly-interpolating the components of matrices does not create anything that
            resembles an inbetween transformation. However, linearly interpolating a pair of
            quaternions does. As long as you normalize the results.</p><p>The <span class="propername">Interpolation</span> tutorial demonstrates this. The
                <span class="keycap"><strong>Q</strong></span>, <span class="keycap"><strong>W</strong></span>, <span class="keycap"><strong>E</strong></span>, <span class="keycap"><strong>R</strong></span>,
                <span class="keycap"><strong>T</strong></span>, <span class="keycap"><strong>Y</strong></span>, and <span class="keycap"><strong>U</strong></span> keys cause the ship
            to interpolate to a new orientation. Each key corresponds to a particular orientation,
            and the <span class="keycap"><strong>Q</strong></span> key is the initial orientation.</p><p>We can see that there are some pretty reasonable looking transitions. The transition
            from <span class="keycap"><strong>Q</strong></span> to <span class="keycap"><strong>W</strong></span>, for example. However, there are some
            other transitions that do not look so good; the <span class="keycap"><strong>Q</strong></span> to <span class="keycap"><strong>E</strong></span>
            transition. What exactly is going on?</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8596"></a>The Long Path</h3></div></div></div><p>Unit quaternions represent orientations, but they are also vector directions.
                Specifically, directions in a four-dimensional space. Being unit vectors, they
                represent points on a 4D sphere of radius one. Therefore, the path between two
                orientations can be considered to be simply moving from one direction to another on
                the surface of the 4D sphere.</p><p>While unit quaternions do represent orientations, a quaternion is not a
                    <span class="emphasis"><em>unique</em></span> representation of an orientation. That is, there are
                multiple quaternions that represent the same orientation. Well, there are
                two.</p><p>The conjugate of a quaternion, its inverse orientation, is the negation of the
                vector part of the quaternion. If you negate all four components however, you get
                something quite different: the same orientation as before. Negating a quaternion
                does not affect its orientation.</p><p>While the two quaternions represent the same orientation, they are not the same as
                far as interpolation is concerned. Consider a two-dimensional case:</p><div class="figure"><a name="d0e8610"></a><p class="title"><b>Figure&nbsp;8.5.&nbsp;Interpolation Directions</b></p><div class="figure-contents"><div class="mediaobject"><img src="InterpolateDirection.svg" alt="Interpolation Directions"></div></div></div><br class="figure-break"><p>If the angle between the two quaternions is greater than 90&deg;, then the
                interpolation between them will take the <span class="quote">&#8220;<span class="quote">long path</span>&#8221;</span> between the two
                orientations. Which is what we see in the <span class="keycap"><strong>Q</strong></span> to <span class="keycap"><strong>E</strong></span>
                transition. The orientation <span class="keycap"><strong>R</strong></span> is the negation of
                <span class="keycap"><strong>E</strong></span>; if you try to interpolate between them, nothing changes. The
                    <span class="keycap"><strong>Q</strong></span> to <span class="keycap"><strong>R</strong></span> transition looks much better
                behaved.</p><p>This can be detected easily enough. If the 4-vector dot product between the two
                quaternions is less than zero, then the long path will be taken. If you want to
                prevent the long path from being used, simply negate one of the quaternions before
                interpolating if you detect this. Similarly, if you want to force the long path,
                then ensure that the angle is greater than 90&deg; by negating a quaternion if the dot
                product is greater than zero.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8641"></a>Interpolation Speed</h3></div></div></div><p>There is another problem. Notice how fast the <span class="keycap"><strong>Q</strong></span> to
                    <span class="keycap"><strong>E</strong></span> interpolation is. It starts off slow, then rapidly spins
                around, then slows down towards the end. Why does this happen?</p><p>The linear interpolation code looks like this:</p><div class="example"><a name="d0e8654"></a><p class="title"><b>Example&nbsp;8.5.&nbsp;Quaternion Linear Interpolation</b></p><div class="example-contents"><pre class="programlisting">glm::fquat Lerp(<span class="code-keyword">const</span> glm::fquat &amp;v0, <span class="code-keyword">const</span> glm::fquat &amp;v1, <span class="code-keyword">float</span> alpha)
{
    glm::vec4 start = Vectorize(v0);
    glm::vec4 end = Vectorize(v1);
    glm::vec4 interp = glm::mix(start, end, alpha);
    interp = glm::normalize(interp);
    <span class="code-keyword">return</span> glm::fquat(interp.w, interp.x, interp.y, interp.z);
}</pre></div></div><br class="example-break"><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>GLM's quaternion support does something unusual. The W component is given
                    first to the <span class="type">fquat</span> constructor. Be aware of that when looking
                    through the code.</p></div><p>The <code class="function">Vectorize</code> function simply takes a quaternion and returns
                a <span class="type">vec4</span>; this is necessary because GLM <span class="type">fquat</span> do not support
                many of the operations that GLM <span class="type">vec4</span>'s do. In this case, the
                    <span class="type">glm::mix</span> function, which performs component-wise linear
                interpolation.</p><p>Each component of the vector is interpolated separately from the rest. The
                quaternion for <span class="keycap"><strong>Q</strong></span> is (0.7071f, 0.7071f, 0.0f, 0.0f), while the
                quaternion for <span class="keycap"><strong>E</strong></span> is (-0.4895f, -0.7892f, -0.3700f, -0.02514f). In
                order for the first componet of Q to get to E's first component, it will have to go
                through zero.</p><p>When the alpha is around 0.5, half-way through the movement, the resultant vector
                before normalization is very small. But the vector itself is not what provides the
                orientation; the <span class="emphasis"><em>direction</em></span> of the 4D vector is. Which is why it
                moves very fast in the middle: the direction is changing rapidly.</p><p>In order to get smooth interpolation, we need to interpolate based on the
                direction of the vectors. That is, we interpolate along the angle between the two
                vectors. This kind of interpolation is called <em class="glossterm">spherical linear
                    interpolation</em> or <em class="glossterm">slerp</em>.</p><p>To see the difference this makes, press the <span class="keycap"><strong>SpaceBar</strong></span>; this
                toggles between regular linear interpolation and slerp. The slerp version is much
                smoother.</p><p>The code for slerp is rather complex:</p><div class="example"><a name="d0e8710"></a><p class="title"><b>Example&nbsp;8.6.&nbsp;Spherical Linear Interpolation</b></p><div class="example-contents"><pre class="programlisting">glm::fquat Slerp(<span class="code-keyword">const</span> glm::fquat &amp;v0, <span class="code-keyword">const</span> glm::fquat &amp;v1, <span class="code-keyword">float</span> alpha)
{
    <span class="code-keyword">float</span> dot = glm::dot(v0, v1);
    
    <span class="code-keyword">const</span> <span class="code-keyword">float</span> DOT_THRESHOLD = <span class="code-number">0.9995f</span>;
    <span class="code-keyword">if</span> (dot &gt; DOT_THRESHOLD)
        <span class="code-keyword">return</span> Lerp(v0, v1, alpha);
    
    glm::clamp(dot, -<span class="code-number">1.0f</span>, <span class="code-number">1.0f</span>);
    <span class="code-keyword">float</span> theta_<span class="code-number">0</span> = acosf(dot);
    <span class="code-keyword">float</span> theta = theta_<span class="code-number">0</span>*alpha;
    
    glm::fquat v2 = v1 - v0*dot;
    v2 = glm::normalize(v2);
    
    <span class="code-keyword">return</span> v0*cos(theta) + v2*sin(theta);
}</pre></div></div><br class="example-break"><div class="sidebar"><p class="title"><b>Slerp and Performance</b></p><p>It's important to know what kind of problems slerp is intended to solve and
                    what kind it is not. Slerp becomes increasingly more important the more
                    disparate the two quaternions being interpolated are. If you know that two
                    quaternions are always quite close to one another, then slerp is not worth the
                    expense.</p><p>The <code class="function">acos</code> call in the slerp code alone is pretty
                    substantial in terms of performance. Whereas lerp is typically just a
                    vector/scalar multiply followed by a vector/vector addition. Even on the CPU,
                    the performance difference is important, particularly if you're doing thousands
                    of these per frame. As you might be in an animation system.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="Tut08 Camera Relative Orientation.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="Tutorial 08.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="Tut08 In Review.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Camera-Relative Orientation&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="/web/20150225192607/http://www.arcsynthesis.org/gltut/index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;In Review</td></tr></table></div></body></html>




<!--
     FILE ARCHIVED ON 19:26:07 Feb 25, 2015 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 19:09:16 Mar 29, 2015.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
