<html><head>


<script type="text/javascript" src="/static/js/analytics.js"></script>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app16.us.archive.org";archive_analytics.values.server_ms=95;</script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>


      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>Optimization: Base Vertex</title><link rel="stylesheet" href="chunked.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="../index.html" title="Learning Modern 3D Graphics Programming"><link rel="up" href="Tutorial 05.html" title="Chapter&nbsp;5.&nbsp;Objects in Depth"><link rel="prev" href="Tutorial 05.html" title="Chapter&nbsp;5.&nbsp;Objects in Depth"><link rel="next" href="Tut05 Overlap and Depth Buffering.html" title="Overlap and Depth Buffering"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(){
var wbPrefix = "/web/";
var wbCurrentUrl = "http://www.arcsynthesis.org/gltut/Positioning/Tut05%20Optimization%20Base%20Vertex.html";

var firstYear = 1996;
var imgWidth = 500,imgHeight = 27;
var yearImgWidth = 25,monthImgWidth = 2;
var displayDay = "25";
var displayMonth = "Feb";
var displayYear = "2015";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function getElementX2(obj) {
  var $e=jQuery(obj);
  return (typeof $e=="undefined"||typeof $e.offset=="undefined")?
    getElementX(obj):Math.round($e.offset().left);
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX2(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})();//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>
<div id="wm-ipp" lang="en" style="display:none;">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="/web/" title="Wayback Machine home page"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0" /></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://www.arcsynthesis.org/gltut/Positioning/Tut05%20Optimization%20Base%20Vertex.html" style="width:400px;" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20150225192611" /><input type="submit" value="Go" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="/web/20140717100844/http://www.arcsynthesis.org/gltut/Positioning/Tut05%20Optimization%20Base%20Vertex.html" title="17 Jul 2014">JUL</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 19:26:11 Feb 25, 2015">FEB</td>
		<td class="f" nowrap="nowrap">
		
		    Mar
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="/web/20140717100844/http://www.arcsynthesis.org/gltut/Positioning/Tut05%20Optimization%20Base%20Vertex.html" title="10:08:44 Jul 17, 2014"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 19:26:11 Feb 25, 2015">25</td>
	       <td class="f" nowrap="nowrap">
               
                   <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
               
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   <a href="/web/20131205185433/http://www.arcsynthesis.org/gltut/Positioning/Tut05%20Optimization%20Base%20Vertex.html" title="5 Dec 2013"><strong>2013</strong></a>
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 19:26:11 Feb 25, 2015">2015</td>
	       <td class="f" nowrap="nowrap">
               
                   2016
               
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="/web/20150225192611*/http://www.arcsynthesis.org/gltut/Positioning/Tut05%20Optimization%20Base%20Vertex.html" title="See a list of every capture for this URL">38 captures</a>
           <div class="r" title="Timespan for captures of this URL">8 Jan 11 - 25 Feb 15</div>
       </td>
       <td class="k">
       <a href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines"
		 onmouseover="__wm.st(1)" onmouseout="__wm.st(0)"
		 onmousemove="__wm.mv(event,this)"
		 width="500"
		 height="27"
		 border="0"
		 src="/web/jsp/graph.jsp?graphdata=500_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000000_2011:-1:101100111021_2012:-1:201021100030_2013:-1:112112111211_2014:-1:000101100000_2015:1:010000000000" />
       </div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>
<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->
<div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Optimization: Base Vertex</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="Tutorial 05.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;5.&nbsp;Objects in Depth</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="Tut05 Overlap and Depth Buffering.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e5135"></a>Optimization: Base Vertex</h2></div></div></div><p>Using VAOs can dramatically simplify code. However, VAOs are not always the best case
            for performance, particularly if you use a lot of separate buffer objects.</p><p>Binding a VAO for rendering can be an expensive proposition. Therefore, if there is a
            way to avoid binding one, then it can provide a performance improvement, if the program
            is currently bottlenecked on the CPU.</p><p>Our two objects have much in common. They use the same vertex attribute indices, since
            they are being rendered with the same program object. They use the same format for each
            attribute (3 floats for positions, 4 floats for colors). The vertex data even comes from
            the same buffer object.</p><p>Indeed, the <span class="emphasis"><em>only</em></span> difference between the two objects is what
            offset each attribute uses. And even this is quite minimal, since the difference between
            the offsets is a constant factor of the size of each attribute.</p><p>Look at the vertex data in the buffer object:</p><div class="example"><a name="d0e5152"></a><p class="title"><b>Example&nbsp;5.5.&nbsp;Vertex Attribute Data Abridged</b></p><div class="example-contents"><pre class="programlisting"><span class="code-comment">//Object 1 positions</span>
LEFT_EXTENT,    TOP_EXTENT,       REAR_EXTENT,
LEFT_EXTENT,    MIDDLE_EXTENT,    FRONT_EXTENT,
RIGHT_EXTENT,   MIDDLE_EXTENT,    FRONT_EXTENT,

...

RIGHT_EXTENT,   TOP_EXTENT,       REAR_EXTENT,
RIGHT_EXTENT,   BOTTOM_EXTENT,    REAR_EXTENT,

<span class="code-comment">//Object 2 positions</span>
TOP_EXTENT,     RIGHT_EXTENT,     REAR_EXTENT,
MIDDLE_EXTENT,  RIGHT_EXTENT,     FRONT_EXTENT,
MIDDLE_EXTENT,  LEFT_EXTENT,      FRONT_EXTENT,

...

TOP_EXTENT,     RIGHT_EXTENT,     REAR_EXTENT,
TOP_EXTENT,     LEFT_EXTENT,      REAR_EXTENT,
BOTTOM_EXTENT,  LEFT_EXTENT,      REAR_EXTENT,

<span class="code-comment">//Object 1 colors</span>
GREEN_COLOR,
GREEN_COLOR,
GREEN_COLOR,

...

BROWN_COLOR,
BROWN_COLOR,

<span class="code-comment">//Object 2 colors</span>
RED_COLOR,
RED_COLOR,
RED_COLOR,

...

GREY_COLOR,
GREY_COLOR,</pre></div></div><br class="example-break"><p>Notice how the attribute array for object 2 immediately follows its corresponding
            attribute array for object 1. So really, instead of four attribute arrays, we really
            have just two attribute arrays.</p><p>If we were doing array drawing, we could simply have one VAO, which sets up the
            beginning of both combined attribute arrays. We would still need 2 separate draw calls,
            because there is a uniform that is different for each object. But our rendering code
            could look like this:</p><div class="example"><a name="d0e5161"></a><p class="title"><b>Example&nbsp;5.6.&nbsp;Array Drawing of Two Objects with One VAO</b></p><div class="example-contents"><pre class="programlisting">glUseProgram(theProgram);

glBindVertexArray(vaoObject);
glUniform3f(offsetUniform, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>);
glDrawArrays(GL_TRIANGLES, <span class="code-number">0</span>, numTrianglesInObject1);

glUniform3f(offsetUniform, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>, -<span class="code-number">1.0f</span>);
glDrawArrays(GL_TRIANGLES, numTrianglesInObject1, numTrianglesInObject2);

glBindVertexArray(<span class="code-number">0</span>);
glUseProgram(<span class="code-number">0</span>);</pre></div></div><br class="example-break"><p>This is all well and good for array drawing, but we are doing indexed drawing. And
            while we can control the location we are reading from in the element buffer by using the
                <em class="parameter"><code>count</code></em> and <em class="parameter"><code>indices</code></em> parameter of
                <code class="function">glDrawElements</code>, that only specifies which indices we are
            reading from the element buffer. What we would need is a way to modify the index data
            itself.</p><p>This could be done by simply storing the index data for object 2 in the element
            buffer. This changes our element buffer into the following:</p><div class="example"><a name="d0e5179"></a><p class="title"><b>Example&nbsp;5.7.&nbsp;MultiObject Element Buffer</b></p><div class="example-contents"><pre class="programlisting"><span class="code-keyword">const</span> GLshort indexData[] =
{
<span class="code-comment">//Object 1</span>
<span class="code-number">0</span>, <span class="code-number">2</span>, <span class="code-number">1</span>,        <span class="code-number">3</span>, <span class="code-number">2</span>, <span class="code-number">0</span>,
<span class="code-number">4</span>, <span class="code-number">5</span>, <span class="code-number">6</span>,        <span class="code-number">6</span>, <span class="code-number">7</span>, <span class="code-number">4</span>,
<span class="code-number">8</span>, <span class="code-number">9</span>, <span class="code-number">10</span>,       <span class="code-number">11</span>, <span class="code-number">13</span>, <span class="code-number">12</span>,
<span class="code-number">14</span>, <span class="code-number">16</span>, <span class="code-number">15</span>,     <span class="code-number">17</span>, <span class="code-number">16</span>, <span class="code-number">14</span>,

<span class="code-comment">//Object 2</span>
<span class="code-number">18</span>, <span class="code-number">20</span>, <span class="code-number">19</span>,     <span class="code-number">21</span>, <span class="code-number">20</span>, <span class="code-number">18</span>,
<span class="code-number">22</span>, <span class="code-number">23</span>, <span class="code-number">24</span>,     <span class="code-number">24</span>, <span class="code-number">25</span>, <span class="code-number">22</span>,
<span class="code-number">26</span>, <span class="code-number">27</span>, <span class="code-number">28</span>,     <span class="code-number">29</span>, <span class="code-number">31</span>, <span class="code-number">30</span>,
<span class="code-number">32</span>, <span class="code-number">34</span>, <span class="code-number">33</span>,     <span class="code-number">35</span>, <span class="code-number">34</span>, <span class="code-number">32</span>,
};</pre></div></div><br class="example-break"><p>This would work for our simple example here, but it does needlessly take up room. What
            would be great is a way to simply add a bias value to the index after it is pulled from
            the element array, but <span class="emphasis"><em>before</em></span> it is used to access the attribute
            data.</p><p>I'm sure you'll be surprised to know that OpenGL offers such a mechanism, what with me
            bringing it up and all.</p><p>The function <code class="function">glDrawElementsBaseVertex</code> provides this
            functionality. It works like <code class="function">glDrawElements</code> has one extra parameter
            at the end, which is the offset to be applied to each index. The tutorial project
                <span class="propername">Base Vertex With Overlap</span> demonstrates
            this.</p><p>The initialization changes, building only one VAO.</p><div class="example"><a name="d0e5204"></a><p class="title"><b>Example&nbsp;5.8.&nbsp;Base Vertex Single VAO</b></p><div class="example-contents"><pre class="programlisting">glGenVertexArrays(<span class="code-number">1</span>, &amp;vao);
glBindVertexArray(vao);

size_t colorDataOffset = <span class="code-keyword">sizeof</span>(<span class="code-keyword">float</span>) * <span class="code-number">3</span> * numberOfVertices;
glBindBuffer(GL_ARRAY_BUFFER, vertexBufferObject);
glEnableVertexAttribArray(<span class="code-number">0</span>);
glEnableVertexAttribArray(<span class="code-number">1</span>);
glVertexAttribPointer(<span class="code-number">0</span>, <span class="code-number">3</span>, GL_FLOAT, GL_FALSE, <span class="code-number">0</span>, <span class="code-number">0</span>);
glVertexAttribPointer(<span class="code-number">1</span>, <span class="code-number">4</span>, GL_FLOAT, GL_FALSE, <span class="code-number">0</span>, (<span class="code-keyword">void</span>*)colorDataOffset);
glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, indexBufferObject);

glBindVertexArray(<span class="code-number">0</span>);</pre></div></div><br class="example-break"><p>This simply binds the beginning of each array. The rendering code is as
            follows:</p><div class="example"><a name="d0e5211"></a><p class="title"><b>Example&nbsp;5.9.&nbsp;Base Vertex Rendering</b></p><div class="example-contents"><pre class="programlisting">glUseProgram(theProgram);

glBindVertexArray(vao);

glUniform3f(offsetUniform, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>);
glDrawElements(GL_TRIANGLES, ARRAY_COUNT(indexData), GL_UNSIGNED_SHORT, <span class="code-number">0</span>);

glUniform3f(offsetUniform, <span class="code-number">0.0f</span>, <span class="code-number">0.0f</span>, -<span class="code-number">1.0f</span>);
glDrawElementsBaseVertex(GL_TRIANGLES, ARRAY_COUNT(indexData),
	GL_UNSIGNED_SHORT, <span class="code-number">0</span>, numberOfVertices / <span class="code-number">2</span>);

glBindVertexArray(<span class="code-number">0</span>);
glUseProgram(<span class="code-number">0</span>);</pre></div></div><br class="example-break"><p>The first draw call uses the regular glDrawElements function, but the second uses the
            BaseVertex version.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This example of BaseVertex's use is somewhat artificial, because both objects use
                the same index data. The more compelling way to use it is with objects that have
                different index data. Of course, if objects have different index data, you may be
                wondering why you would bother with BaseVertex when you could just manually add the
                offset to the indices themselves when you create the element buffer.</p><p>There are several reasons not to do this. One of these is that
                    <code class="literal">GL_UNSIGNED_INT</code> is twice as large as
                    <code class="literal">GL_UNSIGNED_SHORT</code>. If you have more than 65,536 entries in an
                array, whether for one object or for many, you would need to use ints instead of
                shorts for indices. Using ints can hurt performance, particularly on older hardware
                with less bandwidth. With BaseVertex, you can use shorts for everything, unless a
                particular object itself has more than 65,536 vertices.</p><p>The other reason not to manually bias the index data is to more accurately match
                the files you are using. When loading indexed mesh data from files, the index data
                is not biased by a base vertex; it is all relative to the model's start. So it makes
                sense to keep things that way where possible; it just makes the loading code simpler
                and faster by storing a per-object BaseVertex with the object rather than biasing
                all of the index data.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="Tutorial 05.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="Tutorial 05.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="Tut05 Overlap and Depth Buffering.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;5.&nbsp;Objects in Depth&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="/web/20150225192611/http://www.arcsynthesis.org/gltut/index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Overlap and Depth Buffering</td></tr></table></div></body></html>




<!--
     FILE ARCHIVED ON 19:26:11 Feb 25, 2015 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 19:09:53 Mar 29, 2015.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
